<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MEP Sandbox Engine</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "uhb9ql845d");
  </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4250792589739491" crossorigin="anonymous"></script>
  <style>
    :root {
      --bg: #0a0a0a;
      --surface: #111;
      --border: #222;
      --text: #fff;
      --muted: #888;
      --accent: #fff;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }
    
    /* Navigation */
    nav {
      position: fixed;
      top: 0;
      width: 100%;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(10,10,10,0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      z-index: 1000;
    }
    .logo {
      font-weight: 700;
      font-size: 1.2rem;
      letter-spacing: -0.5px;
    }
    .nav-links {
      display: flex;
      gap: 2rem;
      align-items: center;
    }
    .nav-links a {
      color: var(--muted);
      text-decoration: none;
      font-size: 0.9rem;
      transition: color 0.2s;
    }
    .nav-links a:hover { color: var(--text); }
    
    /* Auth Button */
    .auth-btn {
      background: var(--text);
      color: var(--bg);
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.85rem;
      transition: opacity 0.2s;
    }
    .auth-btn:hover { opacity: 0.9; }
    
    /* Main Content */
    main {
      padding-top: 80px;
    }
    
    /* Hero Section */
    .hero {
      text-align: center;
      padding: 6rem 2rem 4rem;
      max-width: 800px;
      margin: 0 auto;
    }
    .hero h1 {
      font-size: 3.5rem;
      font-weight: 700;
      letter-spacing: -2px;
      margin-bottom: 1rem;
    }
    .hero p {
      color: var(--muted);
      font-size: 1.1rem;
      margin-bottom: 2rem;
    }
    .hero-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }
    .btn-primary {
      background: var(--text);
      color: var(--bg);
      padding: 0.75rem 2rem;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      transition: transform 0.2s, opacity 0.2s;
    }
    .btn-primary:hover { transform: translateY(-2px); opacity: 0.9; }
    .btn-secondary {
      background: transparent;
      color: var(--text);
      padding: 0.75rem 2rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      text-decoration: none;
      font-weight: 500;
      transition: border-color 0.2s;
    }
    .btn-secondary:hover { border-color: var(--muted); }
    
    /* Stats Section */
    .stats {
      display: flex;
      justify-content: center;
      gap: 4rem;
      padding: 2rem;
      margin-bottom: 4rem;
    }
    .stat {
      text-align: center;
    }
    .stat-value {
      font-size: 2.5rem;
      font-weight: 700;
    }
    .stat-label {
      color: var(--muted);
      font-size: 0.9rem;
    }
    
    /* Profile Section */
    .profile-section {
      max-width: 600px;
      margin: 0 auto 4rem;
      padding: 2rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      display: none;
    }
    .profile-section.active { display: block; }
    .profile-section h3 {
      margin-bottom: 1.5rem;
      font-size: 1.2rem;
    }
    .profile-row {
      display: flex;
      gap: 2rem;
      align-items: flex-start;
    }
    .avatar-preview {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--border);
      overflow: hidden;
    }
    .avatar-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .profile-fields {
      flex: 1;
    }
    .profile-fields label {
      display: block;
      color: var(--muted);
      font-size: 0.8rem;
      margin-bottom: 0.5rem;
    }
    .profile-fields input {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 0.75rem;
      border-radius: 6px;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }
    .avatar-presets {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 0.5rem;
    }
    .avatar-preset {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border-color 0.2s;
      overflow: hidden;
      background: var(--border);
    }
    .avatar-preset:hover, .avatar-preset.selected {
      border-color: var(--text);
    }
    .avatar-preset img {
      width: 100%;
      height: 100%;
    }
    .save-profile {
      margin-top: 1rem;
      width: 100%;
    }
    
    /* Roadmap Section */
    .roadmap {
      max-width: 1200px;
      margin: 0 auto;
      padding: 4rem 2rem;
    }
    .roadmap h2 {
      text-align: center;
      margin-bottom: 3rem;
      font-size: 2rem;
    }
    .roadmap-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
    }
    @media (max-width: 900px) {
      .roadmap-grid { grid-template-columns: 1fr; }
    }
    .roadmap-col h4 {
      margin-bottom: 1rem;
      font-size: 0.9rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .roadmap-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .roadmap-card h5 {
      font-size: 0.95rem;
      margin-bottom: 0.5rem;
    }
    .roadmap-card p {
      color: var(--muted);
      font-size: 0.85rem;
    }
    
    /* Footer */
    footer {
      text-align: center;
      padding: 3rem 2rem;
      border-top: 1px solid var(--border);
      color: var(--muted);
      font-size: 0.85rem;
    }
    footer a {
      color: var(--text);
      text-decoration: none;
    }
    footer a:hover { text-decoration: underline; }
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <nav>
    <div class="logo">MEP Sandbox</div>
    <div class="nav-links">
      <a href="#roadmap">Roadmap</a>
      <a href="https://discord.gg/BsUQUFYBmN" target="_blank">Discord</a>
      <a href="https://buy.stripe.com/5kQ6oHcD6amY1i31k0grS0f" target="_blank">Support</a>
      <button class="auth-btn" id="authBtn">Sign In</button>
    </div>
  </nav>

  <main>
    <section class="hero">
      <h1>Build Anything</h1>
      <p>A lightweight sandbox engine for creators. Design, prototype, and bring your ideas to life with MEPLua scripting and 50+ built-in object types.</p>
      <div class="hero-buttons">
        <a href="#" class="btn-primary" id="downloadBtn">Download v1.3</a>
        <a href="https://github.com/FugthChat/MEP-SANDBOX-ENGINE" class="btn-secondary" target="_blank">View Source</a>
      </div>
    </section>

    <section class="stats">
      <div class="stat">
        <div class="stat-value" id="downloadCount">â€”</div>
        <div class="stat-label">Downloads</div>
      </div>
      <div class="stat">
        <div class="stat-value">50+</div>
        <div class="stat-label">Object Types</div>
      </div>
      <div class="stat">
        <div class="stat-value">v1.3</div>
        <div class="stat-label">Latest Release</div>
      </div>
    </section>

    <section class="profile-section" id="profileSection">
      <h3>Your Profile</h3>
      <div class="profile-row">
        <div class="avatar-preview">
          <img id="avatarPreview" src="https://api.dicebear.com/7.x/shapes/svg?seed=creator" alt="Avatar"/>
        </div>
        <div class="profile-fields">
          <label>Display Name</label>
          <input type="text" id="displayName" placeholder="Enter name..." maxlength="24"/>
          <label>Choose Avatar</label>
          <div class="avatar-presets" id="avatarPresets"></div>
        </div>
      </div>
      <button class="auth-btn save-profile" id="saveProfile">Save Profile</button>
    </section>

    <section class="roadmap" id="roadmap">
      <h2>Roadmap</h2>
      <div class="roadmap-grid">
        <div class="roadmap-col">
          <h4>âœ“ Shipped</h4>
          <div class="roadmap-card">
            <h5>Core Rendering Pipeline</h5>
            <p>OpenGL-based 3D renderer with camera controls, lighting, and object hierarchy.</p>
          </div>
          <div class="roadmap-card">
            <h5>50+ Object Types</h5>
            <p>Parts, models, scripts, lights, UI elements, folders, cameras, and more.</p>
          </div>
          <div class="roadmap-card">
            <h5>MEPLua Runtime</h5>
            <p>Custom Lua 5.4 integration with Instance.new(), Vector3, Color3, and event system.</p>
          </div>
          <div class="roadmap-card">
            <h5>Project System</h5>
            <p>Full save/load with .mep project files, autosave, and recent files.</p>
          </div>
          <div class="roadmap-card">
            <h5>Creator Tools</h5>
            <p>Move, scale, rotate handles. Grid snapping. Multi-select. Property editor.</p>
          </div>
          <div class="roadmap-card">
            <h5>Stability & Polish</h5>
            <p>Crash recovery, error logging, memory management, and v1.3 launcher.</p>
          </div>
        </div>
        <div class="roadmap-col">
          <h4>ðŸ”¨ Building Now</h4>
          <div class="roadmap-card">
            <h5>Animation System</h5>
            <p>Timeline editor for keyframe animation on parts and models.</p>
          </div>
          <div class="roadmap-card">
            <h5>Physics Baseline</h5>
            <p>Gravity, collision detection, and basic rigid body simulation.</p>
          </div>
          <div class="roadmap-card">
            <h5>Constraint System</h5>
            <p>Welds, hinges, motors, and springs for interactive creations.</p>
          </div>
          <div class="roadmap-card">
            <h5>UX Improvements</h5>
            <p>Better explorer, faster property editing, keyboard shortcuts.</p>
          </div>
          <div class="roadmap-card">
            <h5>User Profiles</h5>
            <p>Cloud sync for projects and settings via Firebase.</p>
          </div>
        </div>
        <div class="roadmap-col">
          <h4>ðŸ“‹ Up Next</h4>
          <div class="roadmap-card">
            <h5>Character Rigging</h5>
            <p>Skeletal animation support for humanoid and custom rigs.</p>
          </div>
          <div class="roadmap-card">
            <h5>Material Editor</h5>
            <p>PBR materials with texture maps and shader customization.</p>
          </div>
          <div class="roadmap-card">
            <h5>Particle System</h5>
            <p>Visual effects for fire, smoke, sparks, and custom emitters.</p>
          </div>
          <div class="roadmap-card">
            <h5>Audio Engine</h5>
            <p>3D spatial audio with volume, reverb, and sound effects.</p>
          </div>
          <div class="roadmap-card">
            <h5>Play Mode</h5>
            <p>Test your creations without leaving the editor.</p>
          </div>
          <div class="roadmap-card">
            <h5>Visual Scripting</h5>
            <p>Node-based logic for creators who prefer no-code.</p>
          </div>
          <div class="roadmap-card">
            <h5>Multiplayer Foundation</h5>
            <p>Basic networking for collaborative building and games.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-links">
      <a href="https://discord.gg/BsUQUFYBmN">Discord</a>
      <a href="https://github.com/FugthChat/MEP-SANDBOX-ENGINE">GitHub</a>
      <a href="https://buy.stripe.com/5kQ6oHcD6amY1i31k0grS0f">Support Development</a>
    </div>
    <p>Â© 2025 MEP Sandbox Engine. Built for creators.</p>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, addDoc, collection } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAyAioT7g8jkZoybvAhBqaDaXlJh-ZTwV4",
      authDomain: "mepsandboxengine.firebaseapp.com",
      projectId: "mepsandboxengine",
      storageBucket: "mepsandboxengine.appspot.com",
      messagingSenderId: "1044651702498",
      appId: "1:1044651702498:web:abc123"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    const authBtn = document.getElementById('authBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const profileSection = document.getElementById('profileSection');
    const displayNameInput = document.getElementById('displayName');
    const avatarPreview = document.getElementById('avatarPreview');
    const avatarPresetsContainer = document.getElementById('avatarPresets');
    const saveProfileBtn = document.getElementById('saveProfile');
    const downloadCountEl = document.getElementById('downloadCount');

    const avatarSeeds = ['creator', 'builder', 'coder', 'designer', 'pilot', 'wizard', 'ninja', 'explorer', 'artist', 'hacker'];
    let selectedSeed = 'creator';
    let currentUser = null;

    // Initialize avatar presets
    avatarSeeds.forEach(seed => {
      const preset = document.createElement('div');
      preset.className = 'avatar-preset' + (seed === 'creator' ? ' selected' : '');
      preset.innerHTML = `<img src="https://api.dicebear.com/7.x/shapes/svg?seed=${seed}" alt="${seed}"/>`;
      preset.onclick = () => {
        document.querySelectorAll('.avatar-preset').forEach(p => p.classList.remove('selected'));
        preset.classList.add('selected');
        selectedSeed = seed;
        avatarPreview.src = `https://api.dicebear.com/7.x/shapes/svg?seed=${seed}`;
      };
      avatarPresetsContainer.appendChild(preset);
    });

    // Fetch GitHub download stats
    async function fetchGitHubStats() {
      try {
        const res = await fetch('https://api.github.com/repos/FugthChat/MEP-SANDBOX-ENGINE/releases');
        const releases = await res.json();
        let total = 0;
        releases.forEach(release => {
          release.assets?.forEach(asset => {
            total += asset.download_count || 0;
          });
        });
        downloadCountEl.textContent = total.toLocaleString();
      } catch (e) {
        downloadCountEl.textContent = 'â€”';
      }
    }
    fetchGitHubStats();

    // Track download
    async function trackDownload(user) {
      try {
        await addDoc(collection(db, 'downloads'), {
          userId: user?.uid || 'anonymous',
          timestamp: new Date(),
          version: 'v1.3'
        });
      } catch (e) {
        console.log('Download tracking skipped');
      }
    }

    // Download button
    downloadBtn.onclick = async (e) => {
      e.preventDefault();
      await trackDownload(currentUser);
      window.location.href = 'https://github.com/FugthChat/MEP-SANDBOX-ENGINE/raw/main/MicahEngineStudio_v1.3.rar';
    };

    // Load profile
    async function loadProfile(uid) {
      try {
        const docSnap = await getDoc(doc(db, 'users', uid));
        if (docSnap.exists()) {
          const data = docSnap.data();
          displayNameInput.value = data.displayName || '';
          selectedSeed = data.avatarSeed || 'creator';
          avatarPreview.src = `https://api.dicebear.com/7.x/shapes/svg?seed=${selectedSeed}`;
          document.querySelectorAll('.avatar-preset').forEach(p => {
            p.classList.toggle('selected', p.querySelector('img').src.includes(selectedSeed));
          });
        }
      } catch (e) {
        console.log('Profile load error');
      }
    }

    // Save profile
    saveProfileBtn.onclick = async () => {
      if (!currentUser) return;
      try {
        await setDoc(doc(db, 'users', currentUser.uid), {
          displayName: displayNameInput.value.slice(0, 24),
          avatarSeed: selectedSeed,
          updatedAt: new Date()
        }, { merge: true });
        saveProfileBtn.textContent = 'Saved!';
        setTimeout(() => saveProfileBtn.textContent = 'Save Profile', 2000);
      } catch (e) {
        saveProfileBtn.textContent = 'Error';
        setTimeout(() => saveProfileBtn.textContent = 'Save Profile', 2000);
      }
    };

    // Auth state
    onAuthStateChanged(auth, async (user) => {
      currentUser = user;
      if (user) {
        authBtn.textContent = 'Sign Out';
        profileSection.classList.add('active');
        await loadProfile(user.uid);
      } else {
        authBtn.textContent = 'Sign In';
        profileSection.classList.remove('active');
      }
    });

    // Auth button
    authBtn.onclick = async () => {
      if (currentUser) {
        await signOut(auth);
      } else {
        try {
          await signInWithPopup(auth, provider);
        } catch (e) {
          console.log('Auth error');
        }
      }
    };
  </script>
</body>
</html>
